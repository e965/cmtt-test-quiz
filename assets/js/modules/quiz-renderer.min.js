import{U}from"./u.min.js";export class QuizRenderer{constructor(e,t){this.questions=e,this.results=t,this.qLength=this.questions.length,this.qNum=0,this.score=0,this.refresh()}getCurrentQuestion(){return this.questions[this.qNum]}nextQuestion(){this.qNum++,this.showQuestion()}increaseScore(){this.score++}showTest(){U.showScreen("quiz")}refresh(){this.qNum=0,this.score=0,this.questions.forEach((e=>{U.shuffleArray(e.answers)}))}showQuestion(){let e=this.getCurrentQuestion(),t=document.importNode($make.qs("#question").content,!0),s=$make.qsf(".question",t);$make.qsf(".question__counter",s).textContent=`${this.qNum+1}/${this.qLength}`,$make.qsf(".question__counter",s).addEventListener("dblclick",(e=>{this.score=Math.floor(Math.random()*(this.qLength+1)),this.final()})),$make.qsf(".question__title",s).textContent=e.question,e.answers.forEach((e=>{let t=$create.elem("li"),n=$create.elem("button",e.text,"button button__answer");n.addEventListener("click",(n=>{"answered"in s.dataset||(s.dataset.answered="",t.dataset.selected="","right"in e&&e.right?(t.dataset.right="",this.increaseScore()):t.dataset.wrong="",$make.qsf(".question__explanation",s).textContent="",$make.qsf(".question__explanation",s).insertAdjacentHTML("afterbegin",e.explanation))})),t.appendChild(n),$make.qsf(".question__answers",s).appendChild(t)}));let n=$make.qsf(".question__next-btn",s);this.qNum+1!==this.qLength?n.addEventListener("click",(e=>{this.nextQuestion()})):(n.firstChild.textContent="Завершить тест",n.addEventListener("click",(e=>{this.final()})));let i=$make.qs(".screen-quiz");U.clearNode(i,["resize-sensor"]),i.appendChild(s)}final(){let e=-1;Object.keys(this.results).forEach((t=>{this.score>=Number(t)&&e++}));let t=Object.entries(this.results)[e],s=document.importNode($make.qs("#final").content,!0),n=$make.qsf(".background",s);n.dataset.scoreKey=t[0];let i=$make.qsf(".final",s);$make.qsf(".final__score",i).textContent=`${this.score} из ${this.qLength} правильных ответов`,$make.qsf(".final__text",i).textContent=t[1].text,$make.qsf(".likely",i).dataset.url=window.self==window.top?location.href:parent.location.href,$make.qsf(".final__refresh-btn",i).addEventListener("click",(e=>{this.refresh(),this.showQuestion(),this.showTest()}));let a=$make.qs(".screen-final");U.clearNode(a,["resize-sensor"]),a.appendChild(n),a.appendChild(i),setTimeout(likely.initiate,0),U.showScreen("final")}}